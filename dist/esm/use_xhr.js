import{do_retry_task as e}from"./core.js";class t{#e;constructor(e={}){this.#e=e}#t=new Map;get request_interceptors(){return[...this.#t.keys()]}#r=new Map;get response_interceptors(){return[...this.#r.keys()]}add_request_interceptor(e,t){this.#t.set(e,t)}remove_request_interceptor(e){this.#t.delete(e)}clear_request_interceptor(){this.#t.clear()}add_response_interceptor(e,t){this.#r.set(e,t)}remove_response_interceptor(e){this.#r.delete(e)}clear_response_interceptor(){this.#r.clear()}#s=new Map;get scopes(){return[...this.#s.keys()]}cancel_scope(e){this.#s.get(e)?.forEach((e=>e())),this.#s.delete(e)}cancel_scopes(...e){e.forEach((e=>{this.cancel_scope(e)}))}cancel_all(){this.#s.forEach((e=>{e.forEach((e=>e()))})),this.#s.clear()}static isCancel=e=>!!e.isCancel;isCancel=e=>!!e.isCancel;insert_or_create(e,t){const r=this.#s.get(e);r?r.add(t):this.#s.set(e,new Set([t]))}common_xhr(e,t,r,s){return new Promise(((o,n)=>{const c=new XMLHttpRequest;if(this.#t.forEach((e=>{e.fn(s)})),this.insert_or_create(t,(()=>{c?.abort?.()})),c.open(e,r,s.async??!0),s.mimeType&&c.overrideMimeType(s.mimeType),s.headers)for(let e in s.headers)c.setRequestHeader(e,s.headers[e]);c.responseType=s.responseType??"",c.timeout=s.timeout??0,c.withCredentials=s.withCredentials??!1,c.onabort=e=>{s.onabort?.call(c,e),this.#r.forEach((t=>{t.reject(e)})),Object.defineProperties(e,{isCancel:{value:!0,writable:!1}}),n(e)},c.onerror=e=>{s.onerror?.call(c,e),this.#r.forEach((t=>{t.reject(e)})),n(e)},c.onload=e=>{s.onload?.call(c,e);const t={readyState:c.readyState,response:c.response,responseText:c.responseText,responseURL:c.responseURL,responseXML:c.responseXML,status:c.status,statusText:c.statusText,DONE:c.DONE,HEADERS_RECEIVED:c.HEADERS_RECEIVED,LOADING:c.LOADING,OPENED:c.OPENED,UNSENT:c.UNSENT,getAllResponseHeaders:c.getAllResponseHeaders,getResponseHeader:c.getResponseHeader};this.#r.forEach((e=>{e.fulfill(t)})),o(t)},c.onloadstart=s.onloadstart??null,c.onloadend=s.onloadend??null,c.onprogress=s.onprogress??null,c.onreadystatechange=s.onreadystatechange??null,c.ontimeout=s.ontimeout??null,c.send(s.body)}))}get(e,t,r){return this.common_xhr("GET",e,t,r)}get_retry(t,r,s,o){return e(r,this.common_xhr,["GET",t,s,o],this.isCancel)}post(e,t,r){return this.common_xhr("POST",e,t,r)}post_retry(t,r,s,o){return e(r,this.common_xhr,["POST",t,s,o],this.isCancel)}delete(e,t,r){return this.common_xhr("DELETE",e,t,r)}delete_retry(t,r,s,o){return e(r,this.common_xhr,["DELETE",t,s,o],this.isCancel)}put(e,t,r){return this.common_xhr("PUT",e,t,r)}put_retry(t,r,s,o){return e(r,this.common_xhr,["PUT",t,s,o],this.isCancel)}head(e,t,r){return this.common_xhr("HEAD",e,t,r)}head_retry(t,r,s,o){return e(r,this.common_xhr,["HEAD",t,s,o],this.isCancel)}connect(e,t,r){return this.common_xhr("CONNECT",e,t,r)}connect_retry(t,r,s,o){return e(r,this.common_xhr,["CONNECT",t,s,o],this.isCancel)}options(e,t,r){return this.common_xhr("OPTIONS",e,t,r)}options_retry(t,r,s,o){return e(r,this.common_xhr,["OPTIONS",t,s,o],this.isCancel)}trace(e,t,r){return this.common_xhr("TRACE",e,t,r)}trace_retry(t,r,s,o){return e(r,this.common_xhr,["TRACE",t,s,o],this.isCancel)}patch(e,t,r){return this.common_xhr("PATCH",e,t,r)}patch_retry(t,r,s,o){return e(r,this.common_xhr,["PATCH",t,s,o],this.isCancel)}}export{t as UseXhr};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlX3hoci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL3VzZV94aHIudHMiXSwic291cmNlc0NvbnRlbnQiOltudWxsXSwibmFtZXMiOlsiVXNlWGhyIiwiZ2xvYmFsX2NvbmZpZyIsImNvbnN0cnVjdG9yIiwidGhpcyIsInJlcXVlc3RfaW50ZXJjZXB0b3JzIiwiTWFwIiwia2V5cyIsInJlc3BvbnNlX2ludGVyY2VwdG9ycyIsImFkZF9yZXF1ZXN0X2ludGVyY2VwdG9yIiwibmFtZSIsImludGVyY2VwdG9yIiwic2V0IiwicmVtb3ZlX3JlcXVlc3RfaW50ZXJjZXB0b3IiLCJkZWxldGUiLCJjbGVhcl9yZXF1ZXN0X2ludGVyY2VwdG9yIiwiY2xlYXIiLCJhZGRfcmVzcG9uc2VfaW50ZXJjZXB0b3IiLCJyZW1vdmVfcmVzcG9uc2VfaW50ZXJjZXB0b3IiLCJjbGVhcl9yZXNwb25zZV9pbnRlcmNlcHRvciIsInNjb3BlcyIsImNhbmNlbF9zY29wZSIsInNjb3BlIiwiZ2V0IiwiZm9yRWFjaCIsImFib3J0IiwiY2FuY2VsX3Njb3BlcyIsImNhbmNlbF9hbGwiLCJhYm9ydHMiLCJzdGF0aWMiLCJldiIsImlzQ2FuY2VsIiwiaW5zZXJ0X29yX2NyZWF0ZSIsImFkZCIsIlNldCIsImNvbW1vbl94aHIiLCJyZXF1ZXN0X3R5cGUiLCJ1cmwiLCJjb25maWciLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInhociIsIlhNTEh0dHBSZXF1ZXN0IiwiZm4iLCJvcGVuIiwiYXN5bmMiLCJtaW1lVHlwZSIsIm92ZXJyaWRlTWltZVR5cGUiLCJoZWFkZXJzIiwic2V0UmVxdWVzdEhlYWRlciIsInJlc3BvbnNlVHlwZSIsInRpbWVvdXQiLCJ3aXRoQ3JlZGVudGlhbHMiLCJvbmFib3J0IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnRpZXMiLCJ2YWx1ZSIsIndyaXRhYmxlIiwib25lcnJvciIsIm9ubG9hZCIsImN1c3RvbV9yZXNwb25zZSIsInJlYWR5U3RhdGUiLCJyZXNwb25zZSIsInJlc3BvbnNlVGV4dCIsInJlc3BvbnNlVVJMIiwicmVzcG9uc2VYTUwiLCJzdGF0dXMiLCJzdGF0dXNUZXh0IiwiRE9ORSIsIkhFQURFUlNfUkVDRUlWRUQiLCJMT0FESU5HIiwiT1BFTkVEIiwiVU5TRU5UIiwiZ2V0QWxsUmVzcG9uc2VIZWFkZXJzIiwiZ2V0UmVzcG9uc2VIZWFkZXIiLCJmdWxmaWxsIiwib25sb2Fkc3RhcnQiLCJvbmxvYWRlbmQiLCJvbnByb2dyZXNzIiwib25yZWFkeXN0YXRlY2hhbmdlIiwib250aW1lb3V0Iiwic2VuZCIsImJvZHkiLCJnZXRfcmV0cnkiLCJyZXRyeSIsImRvX3JldHJ5X3Rhc2siLCJwb3N0IiwicG9zdF9yZXRyeSIsImRlbGV0ZV9yZXRyeSIsInB1dCIsInB1dF9yZXRyeSIsImhlYWQiLCJoZWFkX3JldHJ5IiwiY29ubmVjdCIsImNvbm5lY3RfcmV0cnkiLCJvcHRpb25zIiwib3B0aW9uc19yZXRyeSIsInRyYWNlIiwidHJhY2VfcmV0cnkiLCJwYXRjaCIsInBhdGNoX3JldHJ5Il0sIm1hcHBpbmdzIjoiMENBMEhBLE1BQU1BLEVBSUZDLEdBRUFDLFlBQVlELEVBQTBELElBQ2xFRSxNQUFLRixFQUFpQkEsRUFNMUJHLEdBQXdCLElBQUlDLElBSXhCRCwyQkFDQSxNQUFPLElBQUtELE1BQUtDLEVBQXNCRSxRQU0zQ0MsR0FBeUIsSUFBSUYsSUFJekJFLDRCQUNBLE1BQU8sSUFBS0osTUFBS0ksRUFBdUJELFFBUTVDRSx3QkFBd0JDLEVBQWNDLEdBQ2xDUCxNQUFLQyxFQUFzQk8sSUFBSUYsRUFBTUMsR0FPekNFLDJCQUEyQkgsR0FDdkJOLE1BQUtDLEVBQXNCUyxPQUFPSixHQU10Q0ssNEJBQ0lYLE1BQUtDLEVBQXNCVyxRQVEvQkMseUJBQXlCUCxFQUFjQyxHQUNuQ1AsTUFBS0ksRUFBdUJJLElBQUlGLEVBQU1DLEdBTzFDTyw0QkFBNEJSLEdBQ3hCTixNQUFLSSxFQUF1Qk0sT0FBT0osR0FNdkNTLDZCQUNJZixNQUFLSSxFQUF1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
